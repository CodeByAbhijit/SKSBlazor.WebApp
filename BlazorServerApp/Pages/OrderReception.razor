@page "/order-reception"
@using BlazorServerApp.Models

<style>
    /* ================= VB6 GLOBAL ================= */
    .vb-form {
        width: 820px;
        margin: 16px auto;
        font-family: "MS Sans Serif", Tahoma, Arial, sans-serif;
        font-size: 11px;
        color: #000;
    }

    .vb-title {
        height: 28px;
        background: linear-gradient(#cdddf6, #9fbce6);
        border-top: 1px solid #ffffff;
        border-left: 1px solid #ffffff;
        border-right: 1px solid #4a6ea9;
        border-bottom: 1px solid #4a6ea9;
        padding: 4px 8px;
        font-weight: bold;
    }

    /* ================= BODY ================= */
    .vb-body {
        border: 1px solid #999;
        background: #f2f2f2;
        padding: 8px;
        height: 760px;
        box-sizing: border-box;
    }

    /* ================= FRAMES ================= */
    .frame {
        background: #f0f0f0;
        padding: 6px;
        margin-bottom: 6px;
        border-top: 1px solid #ffffff;
        border-left: 1px solid #ffffff;
        border-right: 1px solid #7a7a7a;
        border-bottom: 1px solid #7a7a7a;
    }

    .vb-caption {
        margin-bottom: 6px;
    }

    /* ================= ROWS ================= */
    .vb-row {
        margin-bottom: 6px;
        white-space: nowrap;
    }

    /* ================= CONTROLS ================= */
    .label {
        display: inline-block;
        width: 100px;
        vertical-align: middle;
    }

    input.vb-input {
        height: 18px;
        padding: 1px 3px;
        font-size: 11px;
        border-top: 1px solid #7a7a7a;
        border-left: 1px solid #7a7a7a;
        border-right: 1px solid #ffffff;
        border-bottom: 1px solid #ffffff;
    }

        input.vb-input.short {
            width: 150px;
        }

    textarea.vb-textarea {
        width: 100%;
        height: 80px;
        resize: none;
        border-top: 1px solid #7a7a7a;
        border-left: 1px solid #7a7a7a;
        border-right: 1px solid #ffffff;
        border-bottom: 1px solid #ffffff;
    }

    /* ================= LIST ================= */
    .providers-list {
        height: 120px;
        background: #ffffff;
        overflow-y: auto;
        border-top: 1px solid #7a7a7a;
        border-left: 1px solid #7a7a7a;
        border-right: 1px solid #ffffff;
        border-bottom: 1px solid #ffffff;
    }

    .provider-item {
        padding: 4px 6px;
    }

        .provider-item:hover {
            background: #cdddf6;
        }

    /* ================= PRODUCT ================= */
    .product-input {
        width: 720px;
        height: 20px;
        border: 1px solid #777;
    }

    .product-grid {
        height: 300px;
        background: #808080;
        border-top: 1px solid #404040;
        border-left: 1px solid #404040;
        border-right: 1px solid #c0c0c0;
        border-bottom: 1px solid #c0c0c0;
    }

    /* ================= TOTALS ================= */
    .vb-totals {
        display: flex;
        gap: 24px;
    }

    .tot-left, .tot-right {
        width: 50%;
    }

    .tot-right {
        border-left: 1px dotted #aaa;
        padding-left: 12px;
    }

    /* ================= BUTTONS ================= */
    .btn-flat,
    .btn-ellipsis {
        font-size: 11px;
        padding: 3px 12px;
        background: #e6e6e6;
        cursor: pointer;
        border-top: 1px solid #ffffff;
        border-left: 1px solid #ffffff;
        border-right: 1px solid #555;
        border-bottom: 1px solid #555;
    }

        .btn-flat:active {
            border-top: 1px solid #555;
            border-left: 1px solid #555;
            border-right: 1px solid #ffffff;
            border-bottom: 1px solid #ffffff;
        }


</style>

<div class="vb-form">
    <div class="vb-title">Add Stock Order</div>

    <div class="vb-body">

        <!-- SEARCH SUPPLIER -->
        <div class="frame product-frame">
            <div class="vb-caption">Search supplier</div>

            <div class="vb-row">
                <label class="label">Supplier Name:</label>
                <input class="vb-input" style="width:200px" @bind="txtProviderName" />
                <span class="btn-ellipsis">...</span>
            </div>

            <div class="vb-row">
                <label class="label">Contact name:</label>
                <input class="vb-input short" @bind="txtContactName" />
                <label class="label" style="width:110px;">Contact last name:</label>
                <input class="vb-input short" @bind="txtContactLastName" />
            </div>

            <div class="providers-list">
                @foreach (var p in Providers)
                {
                    <div class="provider-item" @onclick="() => SelectProvider(p)">
                        <strong>@p.CompanyName</strong> - @p.ContactFirstName @p.ContactLastName
                    </div>
                }
            </div>
        </div>

        <!-- SUPPLIER SUMMARY -->
        <div class="frame">
            <div class="vb-row">
                <label class="label">Supplier:</label>
                <input class="vb-input" style="width:220px" readonly @bind="SelectedProviderName" />
                <label class="label" style="width:70px;">Contact:</label>
                <input class="vb-input short" readonly @bind="SelectedProviderContact" />
            </div>
        </div>

        <!-- NOTES -->
        <div class="frame">
            <div class="vb-caption">Notes</div>
            <textarea class="vb-textarea" @bind="txtNotes"></textarea>
            <div style="text-align:right;">
                <span class="btn-ellipsis">...</span>
            </div>
        </div>

        <!-- PRODUCT SEARCH -->
        <div class="vb-row">
            <input class="product-input" placeholder="Search product..." @bind="productQuery" />
            <span class="btn-ellipsis">...</span>
        </div>

        <!-- PRODUCT GRID -->
        <div class="frame">
            <div class="product-grid"></div>
        </div>

        
        <!-- ===== BOTTOM TOTALS (VB6 STYLE – FIXED FRAMES) ===== -->
        <div style="display:flex; gap:12px; margin-top:4px;">

            <!-- LEFT TOTALS -->
            <div class="frame" style="width:4200px; height:110px; padding-top:8px;">
                <div style="margin-bottom:6px;">
                    <label class="label" style="width:120px;">Line quantity:</label>
                    <input class="vb-input short" readonly value="@LineQuantity" />
                </div>

                <div style="margin-bottom:6px;">
                    <label class="label" style="width:120px;">Sales Tax:</label>
                    <input class="vb-input short" @bind="txtSalesTax" />
                </div>

                <div>
                    <label class="label" style="width:120px;">Freight Charge:</label>
                    <input class="vb-input short" @bind="txtFreightCharge" />
                </div>
            </div>

            <!-- RIGHT TOTALS + ACTIONS -->
            <div class="frame"
                 style="width:360px; height:110px; padding-top:8px; position:relative;">

                <div style="margin-bottom:6px;">
                    <label class="label" style="width:110px;">Total Tax:</label>
                    <input class="vb-input short" readonly value="@TotalTaxDisplay" />
                </div>

                <div>
                    <label class="label" style="width:110px;">Sub Total:</label>
                    <input class="vb-input short" readonly value="@SubTotalDisplay" />
                </div>

                <!-- BUTTONS ANCHORED LIKE VB6 -->
                <div style="position:absolute; right:8px; bottom:6px;">
                    <button class="btn-flat">Save</button>
                    <button class="btn-flat" style="margin-left:6px;">Close</button>
                </div>
            </div>

        </div>


    </div>
</div>

@code {
    private string txtProviderName { get; set; } = "";
    private string txtContactName { get; set; } = "";
    private string txtContactLastName { get; set; } = "";
    private string SelectedProviderName { get; set; } = "";
    private string SelectedProviderContact { get; set; } = "";
    private string txtNotes { get; set; } = "";
    private string productQuery { get; set; } = "";
    private string txtSalesTax { get; set; } = "0";
    private string txtFreightCharge { get; set; } = "0";
    private int LineQuantity { get; set; } = 0;

    private string TotalTaxDisplay => "₹ 0.00";
    private string SubTotalDisplay => "₹ 0.00";

    private List<Provider> Providers { get; set; } = new();

    protected override void OnInitialized()
    {
        Providers = new()
        {
            new Provider { ProviderId = 1, CompanyName = "ACME Supplies", ContactFirstName = "John", ContactLastName = "Doe" },
            new Provider { ProviderId = 2, CompanyName = "Global Traders", ContactFirstName = "Ana", ContactLastName = "Smith" }
        };
    }

    private void SelectProvider(Provider p)
    {
        SelectedProviderName = p.CompanyName;
        SelectedProviderContact = $"{p.ContactFirstName} {p.ContactLastName}";
    }
}
